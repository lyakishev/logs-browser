<html>
	<head>
	<title>Инструкция по программе для просмотра логов</title>
	</head>
	<body>
		<h1>Программа для просмотра логов</h1>
		<h2>Инcтрукция по использованию</h2>
		<h3>Хранение логов в БД и используемый язык запросов</h3>
		
		<h4>Хранение логов в БД</h4>

		<p>Выгруженные логи сохраняются в таблицы встроенной базы данных (SQLite). Расположение БД определяется в конфигурационном файле программы.</p>
		<p>После нажатия кнопки <b>Show</b> в блоке управления выгрузкой логов в БД создается таблица, ассоциированная с вкладкой, активной на момент начала выгрузки, с уникальным именем и следующими столбцами:</p>
			<table border="1">
			<tr><th>Имя</th><th>Тип</th><th>Пояснение</th></tr>
			<tr><td>lid</td><td>целое</td><td>первичный ключ; уникальный идентификатор сообщения лога</td>
			<tr><td>date</td><td>текстовое</td><td>дата сообщения в формате ISO</td>
			<tr><td>computer</td><td>текстовое</td><td>имя сервера, с которого был взят лог</td>
			<tr><td>logname</td><td>текстовое</td><td>имя подсистемы (источник) для файловых логов имя евент-лога для евент-логов</td>
			<tr><td>type</td><td>текстовое</td><td>тип сообщения - ошибка(ERROR), предупреждение(WARNING), неопределен(?) и т.п</td>
			<tr><td>source</td><td>текстовое</td><td>файл, в котором находилось сообщение на момент выгрузки (может поменятся!), имя подсистемы для евент-логов</td>
			<tr><td>event</td><td>текстовое</td><td>если евент-лог - 1, если файл-лог - 0</td>
			<tr><td>log</td><td>текстовое</td><td>тело сообщения лога</td>
			</table>

		<h4>Язык запросов</h4>
		<p>Основой языка запросов к БД в программе является язык SQL (<a href="http://www.sqlite.org/lang.html">в варианте БД SQLite</a> - с оператором CASE и др. расширенными возможностями), расширенный следующими возможностями:
		<ul>
		<li>при активной кнопке выбора <b>auto_lid</b> в блоке редактирования запроса, в список полей оператора <i>select</i> автоматически добавляются идентификаторы сообщений логов (хранятся в невидимом столбце <i>rows_for_log_window</i>) - для отображения сообщений в окне просмотра логов.</li>
		<li>для подсветки строки в таблице определенным цветом, в список полей оператора <i>select</i> необходимо добавить следующую конструкцию:
		<pre>
		<b>{<i>поле</i> <i>оператор</i> <i>значение</i> as <i>цвет</i>}</b>
		</pre>
		, где <i>поле, оператор и значение</i> определяют строки, которые будут подсвечены, а <i>цвет</i> - шестнадцатеричное значение цвета в системе RGB с префиксом </b>#</b> (например <b style="color: red">#f00</b> - красный) или имя цвета в системе X11 - <a href="http://tin.le.org/vault/colors.html">имена цветов в системе X11</a> (например <b style="color:coral">coral</b>, <b style="color:khaki">khaki</b>, <b style="color:lightgreen">lightgreen</b>, <b style="color:orange">orange</b>). Пример запроса: <pre>select date, logname, type, {log like ''%380991005400%' as green} from $this order by date desc</pre> - выведет сообщения логов, отсортированные по дате, a строки, соответствующие сообщениям, содержащим текст 380991005400, будут подсвечены зеленым цветом.<br />
		<img src="images/row_hl.png"></img><br />
		Если введено несколько вариантов подсветки и нескольким условиям подсветки удовлетворяет одна строка, то она подсвечивается всеми цветами, условию подсветки которых удовлетворяет сообщение, соответствующее строке. Например, запрос: <pre>
select date, logname, type, {log like '%380991005400%' as green}, {log regexp 'TMP000056' as yellow} from $this order by date desc
</pre>, результат:<br /> <img src="images/several_rows_hl.png"></img>
		</li>
		</ul>
		<p>Поведение цвета и идентификаторов при вложенных и агрегирующих запросах</p>
		<table border="1">
		<tr><th>Вид запроса</th><th>auto_lid</th><th>цвет</th></tr>
		<tr><td>Вложенный</td><td>Идентификаторы сообщений логов автоматически переносятся из вложенных запросов в объемлющие.</td><td>Подсветка строк, заданная во вложенных запросах, автоматически переносится в объемлющие запросы, т.е. подсветка будет видна всегда, где бы не было ее объяаление.</td></tr>
		<tr><td>Агрегирующий (group by и/или агрегирующие функции)</td><td>В строке, представляющей собой результат накопления нескольких строк таблицы, хранятся идентификаторы всех накопленных строк, т.е. в окне просмотра лога будет отображаться текст, состоящий из всех соответствующих сообщений.</td><td>Строка, представляющая собой результат накопления нескольких строк таблицы, будет подсвечена всеми цветами, условиям подсветки которых, удовлятворяет <b>хотя бы одна</b> строка из таблицы.</td></tr>
		</table>

	</body>
</html>

